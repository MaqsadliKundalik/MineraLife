{% extends "base.html" %}
{% block title %}Buyurtmalar xaritasi{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>#orders-full-map{height:560px;border-radius:.75rem;overflow:hidden}</style>
{% endblock %}

{% block content %}
<div class="mb-4 flex items-center justify-between">
  <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Buyurtmalar – xarita</h1>
  <a href="{% url 'orders:list' %}" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
    ← Ro‘yxatga qaytish
  </a>
</div>

<div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
  <div id="orders-full-map" class="bg-gray-200 dark:bg-gray-700"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const points = {{ points|safe }};
  const center = [41.311081, 69.240562];
  const map = L.map('orders-full-map').setView(center, 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const markers = [];
  points.forEach(p => {
    const m = L.marker([p.lat, p.lon]).addTo(map);
    m.bindPopup(`<strong>${p.client}</strong><br>${p.status} · ${p.date}<br>${p.price.toLocaleString()} so'm
                 <br><a href="{% url 'orders:detail' 0 %}".replace('0', p.id) class="text-blue-600 underline">Ko‘rish</a>`);
    markers.push(m);
  });

  if (markers.length) {
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.15));
  }
</script>
{% endblock %}
