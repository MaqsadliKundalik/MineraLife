{% extends "base.html" %}
{% load querystring humanize %}
{% block title %}Hisobotlar{% endblock %}

{% block extra_head %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  .stat-card {
    @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 transition hover:shadow-md;
  }
  .metric-value {
    @apply text-2xl font-bold text-gray-900 dark:text-white;
  }
  .metric-label {
    @apply text-sm text-gray-600 dark:text-gray-400;
  }
  #password-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>
{% endblock %}

{% block content %}

<!-- Parol overlay -->
<div id="password-overlay">
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4">
    <div class="text-center mb-6">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full mb-4">
        <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">üìä Hisobotlar</h2>
      <p class="text-gray-600 dark:text-gray-400">Davom etish uchun parolni kiriting</p>
    </div>
    
    <form id="password-form" class="space-y-4">
      <div>
        <input 
          type="password" 
          id="password-input" 
          placeholder="Parolni kiriting"
          class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 
                 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100
                 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none
                 placeholder-gray-400 dark:placeholder-gray-500"
          autofocus
        >
      </div>
      
      <div id="error-message" class="hidden p-3 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm">
        ‚ùå Noto'g'ri parol!
      </div>
      
      <button 
        type="submit"
        class="w-full px-4 py-3 rounded-lg bg-blue-600 text-white font-medium
               hover:bg-blue-700 active:bg-blue-800 transition shadow-sm"
      >
        üîì Kirish
      </button>
    </form>
    
    <div class="mt-6 text-center">
      <a href="/" class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200">
        ‚Üê Bosh sahifaga qaytish
      </a>
    </div>
  </div>
</div>

<div class="max-w-7xl mx-auto space-y-6 px-4 py-6">

  <!-- Title -->
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">üìä Hisobotlar</h1>
    <div class="flex items-center gap-3">
      {% if excel_available %}
      <a href="{% url 'hisobotlar:export_excel' %}?{% query_transform %}" 
         class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition shadow-sm font-medium text-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Excel yuklab olish
      </a>
      {% endif %}
      <span class="hidden sm:inline-block text-xs px-3 py-1.5 rounded-lg bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium">
        {{ start_date|date:"d.m.Y" }} ‚Äî {{ end_date|date:"d.m.Y" }}
      </span>
    </div>
  </div>

  <!-- Filters -->
  <form method="get"
        class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-5">
    <div class="flex flex-col sm:flex-row sm:items-end gap-3">
      <div class="w-full sm:w-auto">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Boshlanish sanasi</label>
        <input type="date" name="start" value="{{ start_date|date:'Y-m-d' }}"
               class="w-full sm:w-56 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900
                      text-gray-900 dark:text-gray-100 px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm">
      </div>
      <div class="w-full sm:w-auto">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Tugash sanasi</label>
        <input type="date" name="end" value="{{ end_date|date:'Y-m-d' }}"
               class="w-full sm:w-56 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900
                      text-gray-900 dark:text-gray-100 px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm">
      </div>

      <button type="submit" class="w-full sm:w-auto px-5 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition shadow-sm font-medium text-sm">
        üîç Qo'llash
      </button>

      <!-- Quick buttons -->
      <div class="flex gap-2 sm:ml-auto w-full sm:w-auto flex-wrap">
        <a href="?quick=today"
           class="flex-1 sm:flex-none text-center px-3 py-2 rounded-lg transition text-sm font-medium
                  {% if quick == 'today' %}bg-blue-600 text-white shadow-sm
                  {% else %}bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600{% endif %}">
          Bugun
        </a>
        <a href="?quick=week"
           class="flex-1 sm:flex-none text-center px-3 py-2 rounded-lg transition text-sm font-medium
                  {% if quick == 'week' %}bg-blue-600 text-white shadow-sm
                  {% else %}bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600{% endif %}">
          Hozirgi hafta
        </a>
        <a href="?quick=month"
           class="flex-1 sm:flex-none text-center px-3 py-2 rounded-lg transition text-sm font-medium
                  {% if quick == 'month' %}bg-blue-600 text-white shadow-sm
                  {% else %}bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600{% endif %}">
          Hozirgi oy
        </a>
        <a href="?quick=6months"
           class="flex-1 sm:flex-none text-center px-3 py-2 rounded-lg transition text-sm font-medium
                  {% if quick == '6months' %}bg-blue-600 text-white shadow-sm
                  {% else %}bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600{% endif %}">
          6 oy
        </a>
        <a href="?quick=year"
           class="flex-1 sm:flex-none text-center px-3 py-2 rounded-lg transition text-sm font-medium
                  {% if quick == 'year' %}bg-blue-600 text-white shadow-sm
                  {% else %}bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600{% endif %}">
          1 yil
        </a>
      </div>
    </div>
  </form>

  <!-- Asosiy metrikalar -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="stat-card">
      <div class="metric-label text-gray-100">Jami daromad</div>
      <div class="metric-value text-green-600 dark:text-green-400">{{ total|floatformat:0|intcomma }}</div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">so'm</div>
    </div>
    <div class="stat-card">
      <div class="metric-label text-gray-100">Buyurtmalar</div>
      <div class="metric-value text-blue-600 dark:text-blue-400">{{ total_orders|intcomma }}</div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">ta</div>
    </div>
  </div>

  <!-- Chiziqli diagramma - Kunlik savdo -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">üìà Kunlik savdo dinamikasi</h2>
      <div class="flex gap-2 text-xs">
        <button onclick="switchChart('revenue')" id="btn-revenue" class="px-3 py-1.5 rounded-lg bg-blue-600 text-white font-medium transition hover:bg-blue-700">Daromad</button>
        <button onclick="switchChart('orders')" id="btn-orders" class="px-3 py-1.5 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition hover:bg-gray-300 dark:hover:bg-gray-600">Buyurtmalar</button>
        <button onclick="switchChart('quantity')" id="btn-quantity" class="px-3 py-1.5 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition hover:bg-gray-300 dark:hover:bg-gray-600">Miqdor</button>
      </div>
    </div>
    <div style="position: relative; height: 350px;">
      <canvas id="salesChart"></canvas>
    </div>
  </div>

  <!-- To'lov usullari -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">üí∞ To'lov usullari bo'yicha</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
      <!-- Naqd -->
      <div class="flex items-center justify-between px-4 py-3 rounded-lg
                  bg-emerald-50 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200
                  border border-emerald-200 dark:border-emerald-800">
        <span class="inline-flex items-center gap-2 text-sm font-medium">
          <span class="inline-block w-3 h-3 rounded-full bg-emerald-500"></span> Naqd
        </span>
        <span class="font-bold">{{ cash_total|floatformat:0|intcomma }}</span>
      </div>
      <!-- Karta -->
      <div class="flex items-center justify-between px-4 py-3 rounded-lg
                  bg-blue-50 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200
                  border border-blue-200 dark:border-blue-800">
        <span class="inline-flex items-center gap-2 text-sm font-medium">
          <span class="inline-block w-3 h-3 rounded-full bg-blue-500"></span> Karta
        </span>
        <span class="font-bold">{{ card_total|floatformat:0|intcomma }}</span>
      </div>
      <!-- Perechesleniya -->
      <div class="flex items-center justify-between px-4 py-3 rounded-lg
                  bg-violet-50 text-violet-800 dark:bg-violet-900/30 dark:text-violet-200
                  border border-violet-200 dark:border-violet-800">
        <span class="inline-flex items-center gap-2 text-sm font-medium">
          <span class="inline-block w-3 h-3 rounded-full bg-violet-500"></span> Perechesleniya
        </span>
        <span class="font-bold">{{ pereches_total|floatformat:0|intcomma }}</span>
      </div>
      <!-- Qarz -->
      <div class="flex items-center justify-between px-4 py-3 rounded-lg
                  bg-orange-50 text-orange-800 dark:bg-orange-900/30 dark:text-orange-200
                  border border-orange-200 dark:border-orange-800">
        <span class="inline-flex items-center gap-2 text-sm font-medium">
          <span class="inline-block w-3 h-3 rounded-full bg-orange-500"></span> Qarz
        </span>
        <span class="font-bold">{{ debt_total|floatformat:0|intcomma }}</span>
      </div>
    </div>
  </div>

  <!-- Kuryerlar statistikasi -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">üë• Kuryerlar bo'yicha statistika</h2>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="bg-gray-50 dark:bg-gray-900/60 text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700">
            <th class="p-3 text-left font-semibold">Kuryer</th>
            <th class="p-3 text-right font-semibold">Daromad</th>
            <th class="p-3 text-right font-semibold">Buyurtmalar</th>
            <th class="p-3 text-right font-semibold">Mahsulot</th>
            <th class="p-3 text-right font-semibold">O'rtacha</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
          {% for c in courier_stats %}
            <tr class="bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/60 transition">
              <td class="p-3 text-gray-900 dark:text-gray-100 font-medium">
                {{ c.courier__username|default:"Tayinlanmagan" }}
              </td>
              <td class="p-3 text-right text-gray-900 dark:text-gray-100">
                <span class="font-semibold text-green-600 dark:text-green-400">{{ c.total_revenue|floatformat:0|intcomma }}</span> so'm
              </td>
              <td class="p-3 text-right text-gray-900 dark:text-gray-100">{{ c.total_orders|intcomma }} ta</td>
              <td class="p-3 text-right text-gray-900 dark:text-gray-100">{{ c.total_quantity|intcomma }} dona</td>
              <td class="p-3 text-right text-gray-600 dark:text-gray-400 text-xs">{{ c.avg_order|floatformat:0|intcomma }} so'm</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="p-6 text-center text-gray-500 dark:text-gray-400">Ma'lumot yo'q</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Top 10 mijozlar -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">üèÜ Top 10 mijozlar</h2>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
      {% for c in top_clients %}
        <div class="flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 border border-gray-200 dark:border-gray-700 hover:shadow-md transition">
          <div class="flex-1">
            <div class="font-semibold text-gray-900 dark:text-gray-100">{{ forloop.counter }}. {{ c.client__name }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
              {{ c.total_orders }} buyurtma ¬∑ {{ c.total_quantity }} dona
            </div>
          </div>
          <div class="text-right">
            <div class="font-bold text-green-600 dark:text-green-400">{{ c.total_revenue|floatformat:0|intcomma }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">so'm</div>
          </div>
        </div>
      {% empty %}
        <div class="col-span-2 p-6 text-center text-gray-500 dark:text-gray-400">Ma'lumot yo'q</div>
      {% endfor %}
    </div>
  </div>

  <!-- Barcha mijozlar (pagination bilan) -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">üë• Barcha mijozlar</h2>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="bg-gray-50 dark:bg-gray-900/60 text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700">
            <th class="p-3 text-left font-semibold">Mijoz</th>
            <th class="p-3 text-left font-semibold">Manzil</th>
            <th class="p-3 text-right font-semibold">Daromad</th>
            <th class="p-3 text-right font-semibold">Buyurtmalar</th>
            <th class="p-3 text-right font-semibold">Mahsulot</th>
            <th class="p-3 text-left font-semibold">Kur'er</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
          {% for c in clients_page %}
            <tr class="bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/60 transition">
              <td class="p-3 text-gray-900 dark:text-gray-100 font-medium">{{ c.client__name }}</td>
              <td class="p-3 text-gray-600 dark:text-gray-400 text-xs">{{ c.client__caption|default:"‚Äî" }}</td>
              <td class="p-3 text-right text-gray-900 dark:text-gray-100">
                <span class="font-semibold">{{ c.total_revenue|floatformat:0|intcomma }}</span> so'm
              </td>
              <td class="p-3 text-right text-gray-900 dark:text-gray-100">{{ c.total_orders|intcomma }} ta</td>
              <td class="p-3 text-right text-gray-900 dark:text-gray-100">{{ c.total_quantity|intcomma }} dona</td>
              <td class="p-3 text-gray-900 dark:text-gray-100">
                {% with client_couriers|get_item:c.client__id as courier %}
                  {{ courier.username|default:"‚Äî" }}
                {% endwith %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="p-6 text-center text-gray-500 dark:text-gray-400">Ma'lumot yo'q</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if clients_page.has_other_pages %}
    <div class="mt-4 flex items-center justify-center gap-2">
      {% if clients_page.has_previous %}
        <a href="?{% query_transform page=1 %}" class="px-3 py-1.5 rounded bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">¬´ Birinchi</a>
        <a href="?{% query_transform page=clients_page.previous_page_number %}" class="px-3 py-1.5 rounded bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">‚Äπ Oldingi</a>
      {% endif %}

      <span class="px-3 py-1.5 text-sm text-gray-700 dark:text-gray-300">
        {{ clients_page.number }} / {{ clients_page.paginator.num_pages }}
      </span>

      {% if clients_page.has_next %}
        <a href="?{% query_transform page=clients_page.next_page_number %}" class="px-3 py-1.5 rounded bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">Keyingi ‚Ä∫</a>
        <a href="?{% query_transform page=clients_page.paginator.num_pages %}" class="px-3 py-1.5 rounded bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">Oxirgi ¬ª</a>
      {% endif %}
    </div>
    {% endif %}
  </div>

</div>

<script>
// Ma'lumotlarni olish
const chartLabels = {{ chart_labels|safe }};
const chartRevenue = {{ chart_revenue|safe }};
const chartOrders = {{ chart_orders|safe }};
const chartQuantity = {{ chart_quantity|safe }};

// Dark mode aniqlash
const isDarkMode = document.documentElement.classList.contains('dark');
const textColor = isDarkMode ? '#E5E7EB' : '#374151';
const gridColor = isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';

// Diagramma konfiguratsiyasi
let currentChart = null;
let currentMode = 'revenue';

const chartConfig = {
  revenue: {
    label: 'Daromad (so\'m)',
    data: chartRevenue,
    borderColor: '#10b981',
    backgroundColor: 'rgba(16, 185, 129, 0.1)',
  },
  orders: {
    label: 'Buyurtmalar soni',
    data: chartOrders,
    borderColor: '#3b82f6',
    backgroundColor: 'rgba(59, 130, 246, 0.1)',
  },
  quantity: {
    label: 'Mahsulot miqdori (dona)',
    data: chartQuantity,
    borderColor: '#f97316',
    backgroundColor: 'rgba(249, 115, 22, 0.1)',
  }
};

function createChart(mode) {
  const config = chartConfig[mode];
  const ctx = document.getElementById('salesChart').getContext('2d');
  
  if (currentChart) {
    currentChart.destroy();
  }

  currentChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartLabels,
      datasets: [{
        label: config.label,
        data: config.data,
        borderColor: config.borderColor,
        backgroundColor: config.backgroundColor,
        borderWidth: 2,
        tension: 0.4,
        fill: true,
        pointRadius: 3,
        pointHoverRadius: 5,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          labels: {
            color: textColor,
            font: { size: 12 }
          }
        },
        tooltip: {
          mode: 'index',
          intersect: false,
          backgroundColor: isDarkMode ? 'rgba(31, 41, 55, 0.95)' : 'rgba(255, 255, 255, 0.95)',
          titleColor: textColor,
          bodyColor: textColor,
          borderColor: gridColor,
          borderWidth: 1,
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            color: textColor,
            callback: function(value) {
              if (mode === 'revenue') {
                return value.toLocaleString() + ' so\'m';
              }
              return value.toLocaleString();
            }
          },
          grid: {
            color: gridColor
          }
        },
        x: {
          ticks: {
            color: textColor,
            maxRotation: 45,
            minRotation: 0
          },
          grid: {
            color: gridColor
          }
        }
      }
    }
  });
}

function switchChart(mode) {
  currentMode = mode;
  createChart(mode);
  
  // Tugmalarni yangilash
  document.querySelectorAll('[id^="btn-"]').forEach(btn => {
    btn.classList.remove('bg-blue-600', 'text-white');
    btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
  });
  
  const activeBtn = document.getElementById('btn-' + mode);
  activeBtn.classList.add('bg-blue-600', 'text-white');
  activeBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
}

// Sahifa yuklanganda diagrammani yaratish
document.addEventListener('DOMContentLoaded', function() {
  createChart('revenue');
});

// PAROL HIMOYASI
(function() {
  const CORRECT_PASSWORD = 'minera123';
  const overlay = document.getElementById('password-overlay');
  const form = document.getElementById('password-form');
  const input = document.getElementById('password-input');
  const errorMsg = document.getElementById('error-message');
  
  // Session storage'da parol tekshiruvi
  if (sessionStorage.getItem('reports_auth') === 'true') {
    overlay.style.display = 'none';
    return;
  }
  
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const password = input.value;
    
    if (password === CORRECT_PASSWORD) {
      sessionStorage.setItem('reports_auth', 'true');
      overlay.style.display = 'none';
      errorMsg.classList.add('hidden');
    } else {
      errorMsg.classList.remove('hidden');
      input.value = '';
      input.focus();
      // 3 sekunddan keyin xatolikni yashirish
      setTimeout(() => {
        errorMsg.classList.add('hidden');
      }, 3000);
    }
  });
})();
</script>

{% endblock %}
